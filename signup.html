
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SignUp</title>
  <link rel="icon" href="laravel11-carstore-proj/public/images/simple-car-silhouette-sticker-u33a0-x450 5.png">
  <link href="/laravel11-carstore-proj/public/styles/output.css" rel="stylesheet"> 
  <link href="styles/headerStyle.css" rel="stylesheet">
  <link href="styles/loginsignupst.css" rel="stylesheet">
</head>
<body>

  <div class="header" id="headID">


    <div class="left-side">
      <button class="show-btn" onclick="toggleNav()" id="openID">
        <p>&#8801;</p>
      </button>
      <button class="close-btn" onclick="closeAll()" id="closeID">
        <p>X</p>
      </button>
    </div>


    <div class="middle-side">
      <button class="home-btn">
        <a href="index.html">HOME</a> 
      </button>
        
      <button class="about-btn">
        <a href="CarsList.html">CARS</a>
      </button>
      <button class="rev-btn">
        <a href = "review.html" >REVIEWS</a>
      </button>
      <button class="about-btn">
        <a href="About.html">ABOUT</a>
      </button>
      <button class="switch-btn" onclick="switchMode()" id="switchID">SWITCH</button>
    </div>



    <div class="right-side">
      <button class="login-btn">
        <a href="Login.html">LOGIN</a>
      </button>
      <button class="sign-btn">
        <a href="signup.html"> SIGN UP</a>
      </button>
    </div>
  </div>

  <div class="form-container">
      <form class="form" id="signupForm" action="input" method="get">
        <p class="text">Create your Account !</p>
        <div id="error-message" style="display: none; background-color: #fee; color: #c33; padding: 12px; border-radius: 5px; margin-bottom: 15px; border-left: 4px solid #c33; font-size: 14px;"></div>
        <div id="success-message" style="display: none; background-color: #efe; color: #3c3; padding: 12px; border-radius: 5px; margin-bottom: 15px; border-left: 4px solid #3c3; font-size: 14px;"></div>
        <label for ="Username">Full Name</label>
        <input type="text" id="fullname" class="fullnameplc" placeholder="- Enter your Full Name -" required > 
        <span id="fullnameError" class="error"></span>
        <label for="Username">E-mail Address</label> 
        <input type="email" id="email" class="emailplc" placeholder="- Enter your Email Address -" required />
        <span id="emailError" class="error"></span>
        <label for="password">Password</label>
        <input type="password" id="password" class="passwordplc" placeholder="- Enter your Password -" name="password" required />
        <span id="passwordError" class="error"></span>
        <label for ="password">Confirm Password</label>
        <input type="password" id="confirmpassword" class="passwordcnfplc" placeholder="- Confirm your Password -" required > 
        <span id="confirmpasswordError" class="error"></span>

        <br />
      <button type="submit" class= "Signup">Sign Up</button>
      <div class="loading" id="loading" style="display: none; text-align: center; margin-top: 10px; color: #667eea; font-size: 14px;">Creating your account...</div>
      <p class="already">Already have an account? <a href="Login.html" class="alr">Sign In</a></p>
      </form>
  </form>
  </div>
  <div class="bottombar">
    <p class="copyright">Â© 2024 AutoDz. All rights reserved.</p>
    <p class="termsandprivacy">
      <a href="#" class="terms-link">Terms of Service</a> | 
      <a href="#" class="privacy-link">Privacy Policy</a>
    </p>
  </div>
  <script src="scripts/Signupval.js"></script>
  <script src="scripts/headerScript.js"> </script>
  <script src="/public/js/auth.js"></script>
  <script>
    redirectIfAuthenticated('home.html');

    const signupForm = document.getElementById('signupForm');
    const signupBtn = document.getElementById('signup-btn');
    const loadingDiv = document.getElementById('loading');

    function clearFieldError(fieldId) {
      const errorElement = document.getElementById(fieldId + 'Error');
      if (errorElement) errorElement.textContent = '';
    }

    function displayFieldError(fieldId, message) {
      const errorElement = document.getElementById(fieldId + 'Error');
      if (errorElement) errorElement.textContent = message;
    }

    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      clearError('error-message');
      clearError('success-message');
      clearFieldError('fullname');
      clearFieldError('email');
      clearFieldError('password');
      clearFieldError('confirmpassword');
      
      const name = document.getElementById('fullname').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmpassword').value;
      
      let hasError = false;

      if (!name || name.length > 255) {
        displayFieldError('fullname', name ? 'Name too long' : 'Name required');
        hasError = true;
      }

      if (!email) {
        displayFieldError('email', 'Email is required');
        hasError = true;
      }

      if (!password || password.length < 8 || password.length > 12) {
        displayFieldError('password', 'Password must be 8-12 characters');
        hasError = true;
      }

      if (password !== confirmPassword) {
        displayFieldError('confirmpassword', 'Passwords do not match');
        hasError = true;
      }

      if (hasError) {
        displayError('error-message', 'Please fix the errors above');
        return;
      }
      
      signupBtn.disabled = true;
      loadingDiv.style.display = 'block';
      
      try {
        const result = await register(name, email, password);
        
        if (result.success) {
          displaySuccess('success-message', 'Account created successfully! Redirecting...');
          setTimeout(() => {
            window.location.href = 'home.html';
          }, 1500);
        } else {
          let errorMessage = result.error;
          
          if (errorMessage.includes('email') && errorMessage.includes('unique')) {
            errorMessage = 'This email is already registered. Please use a different email or login.';
            displayFieldError('email', 'Email already exists');
          }
          
          displayError('error-message', errorMessage);
          signupBtn.disabled = false;
          loadingDiv.style.display = 'none';
        }
      } catch (error) {
        displayError('error-message', 'An unexpected error occurred. Please try again.');
        signupBtn.disabled = false;
        loadingDiv.style.display = 'none';
      }
    });

    document.getElementById('confirmpassword').addEventListener('input', function() {
      const password = document.getElementById('password').value;
      if (this.value && password !== this.value) {
        displayFieldError('confirmpassword', 'Passwords do not match');
      } else {
        clearFieldError('confirmpassword');
      }
    });
  </script>
</body>
</html>

